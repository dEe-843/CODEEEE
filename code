// Static IP

#include "lwip/netif.h"
#include "lwip/ip_addr.h"
#include "lwip/init.h"
#include "netif/ethernet.h"

struct netif my_netif;
ip_addr_t ipaddr, netmask, gw;

IP4_ADDR(&ipaddr, 192,168,1,123);   // <-- Your desired static IP
IP4_ADDR(&netmask, 255,255,255,0);
IP4_ADDR(&gw, 192,168,1,1);

netif_add(&my_netif, &ipaddr, &netmask, &gw, NULL, ethernetif_init, tcpip_input);
netif_set_default(&my_netif);
netif_set_up(&my_netif);


//DHCP IP

netif_add(&my_netif, IP_ADDR_ANY, IP_ADDR_ANY, IP_ADDR_ANY, NULL, ethernetif_init, tcpip_input);
netif_set_default(&my_netif);
netif_set_up(&my_netif);
dhcp_start(&my_netif);



printf("Assigned IP: %s\n", ip4addr_ntoa(&my_netif.ip_addr));


// Main.C

#include "lwip/init.h"
#include "lwip/netif.h"
#include "lwip/tcpip.h"
#include "netif/ethernet.h"
#include "ethernetif.h"
#include "lwip/ip_addr.h"
#include "lwip/timeouts.h"
#include "lwip/apps/httpd.h"
#include <stdio.h>

struct netif my_netif;

void network_init(void) {
    ip_addr_t ipaddr, netmask, gw;

    // Set a static IP address
    IP4_ADDR(&ipaddr, 192,168,1,123);
    IP4_ADDR(&netmask, 255,255,255,0);
    IP4_ADDR(&gw, 192,168,1,1);

    tcpip_init(NULL, NULL);

    netif_add(&my_netif, &ipaddr, &netmask, &gw, NULL, ethernetif_init, tcpip_input);
    netif_set_default(&my_netif);
    netif_set_up(&my_netif);

    printf("Network initialized with IP: %s\n", ip4addr_ntoa(&ipaddr));
}

int main(void) {
    // Initialize lwIP and network
    network_init();

    // Initialize the HTTP server with fsdata.c
    httpd_init();

    while (1) {
        // Handle lwIP timeouts and events
        sys_check_timeouts();
    }

    return 0;
}


//fsdata.h

#ifndef __FSDATA_H__
#define __FSDATA_H__

struct fsdata_file {
  const struct fsdata_file *next;
  const unsigned char *name;
  const unsigned char *data;
  int len;
};

#define FS_FILE_ALIGNMENT 1

#endif /* __FSDATA_H__ */


//fsdata.c
#include "fsdata.h"

const unsigned char data_index_html[] = {
  /* /index.html */
  0x2f, 0x69, 0x6e, 0x64, 0x65, 0x78, 0x2e, 0x68,
  0x74, 0x6d, 0x6c, 0x00,
  0x3c, 0x68, 0x74, 0x6d, 0x6c, 0x3e,
  0x0a, 0x20, 0x20, 0x3c, 0x68, 0x65, 0x61, 0x64,
  0x3e, 0x3c, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x3e,
  0x50, 0x49, 0x43, 0x33, 0x32, 0x20, 0x57, 0x65,
  0x62, 0x20, 0x53, 0x65, 0x72, 0x76, 0x65, 0x72,
  0x3c, 0x2f, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x3e,
  0x3c, 0x2f, 0x68, 0x65, 0x61, 0x64, 0x3e,
  0x0a, 0x20, 0x20, 0x3c, 0x62, 0x6f, 0x64, 0x79,
  0x3e, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x3c, 0x68,
  0x31, 0x3e, 0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20,
  0x66, 0x72, 0x6f, 0x6d, 0x20, 0x50, 0x49, 0x43,
  0x33, 0x32, 0x21, 0x3c, 0x2f, 0x68, 0x31, 0x3e,
  0x0a, 0x20, 0x20, 0x20, 0x20, 0x3c, 0x70, 0x3e,
  0x54, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
  0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x20, 0x70,
  0x61, 0x67, 0x65, 0x20, 0x73, 0x65, 0x72, 0x76,
  0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x74, 0x68,
  0x65, 0x20, 0x50, 0x49, 0x43, 0x33, 0x32, 0x20,
  0x75, 0x73, 0x69, 0x6e, 0x67, 0x20, 0x6c, 0x77,
  0x49, 0x50, 0x2e, 0x3c, 0x2f, 0x70, 0x3e,
  0x0a, 0x20, 0x20, 0x3c, 0x2f, 0x62, 0x6f, 0x64,
  0x79, 0x3e, 0x0a, 0x3c, 0x2f, 0x68, 0x74, 0x6d,
  0x6c, 0x3e
};

const struct fsdata_file file_index_html[] = {
  {
    NULL,
    data_index_html,
    data_index_html + 12,
    sizeof(data_index_html) - 12
  }
};

#define FS_ROOT file_index_html
#define FS_NUMFILES 1






// Creation of the project 

Great! Here's how you can **create, integrate, and run a web page on your PIC32 microcontroller using lwIP**, with steps to connect it via an IP address:

---

## âœ… Prerequisites
- MPLAB X IDE and XC32 compiler installed
- Your PIC32 project created and configured
- `lwIP` stack ported (your `lwip_port_pic32-master.zip` looks good)
- Ethernet interface (like LAN8720 or ENC28J60) properly configured
- A known static IP or DHCP working

---

## ğŸ“ 1. Files to Add to Your Project

Add these files to your project in MPLAB X under `Source Files` or create a folder like `lwip_web`:

- `main.c` â€“ handles networking and runs the HTTP server  
- `fsdata.c` â€“ contains embedded web page in C array format  
- `fsdata.h` â€“ declares the `fsdata_file` struct used by lwIP  

You can also add your `index.html` for reference, but itâ€™s already embedded in `fsdata.c`.

---

## ğŸ› ï¸ 2. Project Setup in MPLAB X

### a. **Add lwIP to the project**
Ensure the following are added and compiled:
- Core lwIP files (`core`, `netif`, `apps/httpd`)
- `ethernetif.c` and its header (this is your HAL for MAC + PHY)

### b. **Include paths**
Set up include paths:
```
Project Properties > XC32 > Compiler > Include directories:
- ../lwip/src/include
- ../lwip/port
- ../lwip/apps/httpd
```

### c. **Link your files**
Add these files into the project:
```c
main.c
fsdata.c
fsdata.h
```

### d. **Enable the HTTP server**
Define this in `lwipopts.h`:
```c
#define LWIP_HTTPD                 1
#define HTTPD_USE_CUSTOM_FSDATA   1
```

---

## ğŸ”Œ 3. Connect the PIC32 to Your Network

Make sure:
- Ethernet is connected to your router or PC
- The IP address configured in `main.c` (e.g., `192.168.1.123`) is compatible with your network
- You are not behind a strict firewall

---

## â–¶ï¸ 4. Build and Flash

- Build the project in MPLAB X
- Flash the hex to your PIC32 using a debugger (like PICKit3/4, ICD4, or Snap)
- Open a UART terminal (e.g., TeraTerm, PuTTY) to see console logs from `printf()` (if routed properly)

You should see:
```
Network initialized with IP: 192.168.1.123
```

---

## ğŸŒ 5. Access from Your Browser

Once running:
1. Make sure your PC is on the same network (e.g., `192.168.1.x`)
2. Open a browser and go to:
   ```
   http://192.168.1.123
   ```
3. You should see your embedded web page:
   ```
   Hello from PIC32!
   ```



// version 4
Thanks for confirming! MPLAB X IDE v4.70 is a bit older, but still capable of working with PIC32 and lwIP. Hereâ€™s a full step-by-step tailored for **MPLAB X v4.70** with **lwIP and HTTP server on PIC32**.

---

## âœ… Step-by-Step for MPLAB X v4.70 + PIC32 + lwIP Web Server

---

### ğŸ“ 1. Project Structure

Inside your MPLAB project, create folders like this:
```
MyProject/
â”‚
â”œâ”€â”€ main.c               â† System init + lwIP + web server start
â”œâ”€â”€ fsdata.c             â† Contains web page content as C array
â”œâ”€â”€ fsdata.h             â† Declares `fsdata_file` struct
â”œâ”€â”€ index.html           â† (Optional reference)
â”‚
â”œâ”€â”€ lwip/                â† Add lwIP source files
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ netif/
â”‚   â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ apps/httpd/
â”‚   â””â”€â”€ port/            â† Add Ethernet HAL: `ethernetif.c`, `ethernetif.h`
```

---

### ğŸ”§ 2. Project Configuration in MPLAB X v4.70

#### a. Add source files:
Right-click on **Source Files â†’ Add Existing Items**:
- Add `main.c`, `fsdata.c`, and `fsdata.h`

#### b. Add include directories:
Right-click project â†’ **Properties â†’ XC32 â†’ Compiler â†’ Include Directories**:
```
../lwip/include
../lwip/core
../lwip/netif
../lwip/apps/httpd
../lwip/port
```

#### c. Modify `lwipopts.h`:
Make sure these are set:
```c
#define LWIP_HTTPD               1
#define HTTPD_USE_CUSTOM_FSDATA 1
#define NO_SYS                   1
#define LWIP_SOCKET              0
#define LWIP_NETCONN             0
```

---

### ğŸ§  3. Configure IP Address (Static)

In your `main.c`, set the IP manually:
```c
ip4_addr_t ipaddr, netmask, gw;
IP4_ADDR(&ipaddr, 192,168,1,123);   // Static IP
IP4_ADDR(&netmask, 255,255,255,0);
IP4_ADDR(&gw, 192,168,1,1);         // Your router
```

Youâ€™ll see this IP in your browser after programming.

---

### ğŸ”Œ 4. Connect Hardware

- Connect Ethernet cable to PIC32â€™s PHY (LAN8720/ENC28J60)
- Use a PICKit3/4 or ICD4 to flash
- Open UART terminal at 115200 to see debug output
- Supply 3.3V power

---

### â–¶ï¸ 5. Build & Program

- Click **Clean and Build** in MPLAB X
- Click **Make and Program Device**
- Monitor UART for messages like:
  ```
  IP Address: 192.168.1.123
  HTTP Server started...
  ```

---

### ğŸŒ 6. Access from Web Browser

- Ensure your PC is on same network (e.g. 192.168.1.x)
- Open browser and go to:
  ```
  http://192.168.1.123
  ```

You should see the HTML content:
> Hello from PIC32! This is a test page served by the PIC32 using lwIP.

---

### ğŸ§° Optional: Use DHCP Instead of Static

In `main.c`, replace static IP lines with:
```c
dhcp_start(&netif);
```
Ensure:
```c
#define LWIP_DHCP 1
```

///

Great question! Hereâ€™s how and **where to create the `fsdata.c` and `fsdata.h`** files on your system, and how to integrate them into your MPLAB X v4.70 project for your PIC32 lwIP web server.

---

## âœ… Step-by-Step: Create `fsdata.c` and `fsdata.h` on Your System

---

### ğŸ“ 1. Create a Folder for Your Web Files

Letâ€™s assume your project is in:

```
C:\MPLABXProjects\PIC32_WebServer\
```

Inside that, create a new folder:

```
C:\MPLABXProjects\PIC32_WebServer\webpages\
```

Put your web files (e.g., `index.html`) there:
```
C:\MPLABXProjects\PIC32_WebServer\webpages\index.html
```

---

### ğŸ› ï¸ 2. Create `fsdata.c` and `fsdata.h` in Project Source Folder

Create two new files in the `Source Files` directory of your project:

- `C:\MPLABXProjects\PIC32_WebServer\fsdata.c`
- `C:\MPLABXProjects\PIC32_WebServer\fsdata.h`

Or, do it directly from **MPLAB X**:
1. Right-click on **Source Files**
2. Click **New > C Source File** â†’ Name it `fsdata.c`
3. Do the same for `fsdata.h`

---

### ğŸ“„ 3. Paste the `fsdata` Code

Hereâ€™s a minimal example to paste into those files:

#### ğŸ”¹ fsdata.h
```c
#ifndef FSDATA_H
#define FSDATA_H

struct fsdata_file {
    const struct fsdata_file *next;
    const unsigned char *name;
    const unsigned char *data;
    int len;
};

extern const struct fsdata_file file_index_html[];

#define FS_ROOT file_index_html
#define FS_NUMFILES 1

#endif
```

#### ğŸ”¹ fsdata.c
```c
#include "fsdata.h"

static const unsigned char data_index_html[] = {
    /* "/index.html" path name + null */
    0x2f, 0x69, 0x6e, 0x64, 0x65, 0x78, 0x2e, 0x68,
    0x74, 0x6d, 0x6c, 0x00,
    /* HTML content */
    0x3c, 0x68, 0x74, 0x6d, 0x6c, 0x3e,
    0x3c, 0x62, 0x6f, 0x64, 0x79, 0x3e,
    0x3c, 0x68, 0x31, 0x3e,
    0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20,
    0x66, 0x72, 0x6f, 0x6d, 0x20,
    0x50, 0x49, 0x43, 0x33, 0x32, 0x21,
    0x3c, 0x2f, 0x68, 0x31, 0x3e,
    0x3c, 0x2f, 0x62, 0x6f, 0x64, 0x79,
    0x3e, 0x3c, 0x2f, 0x68, 0x74, 0x6d,
    0x6c, 0x3e
};

const struct fsdata_file file_index_html[] = {
    {
        NULL,
        data_index_html,
        data_index_html + 12,
        sizeof(data_index_html) - 12
    }
};
```

This is enough to show a simple web page saying **"Hello from PIC32!"**

---

## ğŸ”— 4. Link the Files in MPLAB X v4.70

Once files are saved:
- Right-click on **Source Files â†’ Add Existing Item**
- Add both `fsdata.c` and `fsdata.h`

---

## ğŸ“Œ Summary

| File | Where to create | Purpose |
|------|------------------|---------|
| `index.html` | `webpages/` folder | Your actual web content |
| `fsdata.c` | Main project folder | Web content as C array |
| `fsdata.h` | Main project folder | Declares structure for lwIP FS |

---

///

Perfect â€” you're very close now! After creating `fsdata.c`, `fsdata.h`, and your project files, hereâ€™s how to **build, program, and run** the lwIP web server on your **PIC32** using **MPLAB X v4.70**.

---

## âœ… Final Steps: How to Run the Web Server on PIC32

---

### ğŸ› ï¸ 1. Add Files to Your Project

In **MPLAB X v4.70**:

1. Right-click **Source Files** â†’ Add:
   - `main.c`
   - `fsdata.c`
2. Right-click **Header Files** â†’ Add:
   - `fsdata.h`
3. Make sure all `lwIP` source files are included:
   - `lwip/core`
   - `lwip/netif`
   - `lwip/apps/httpd`
   - `port` files: `ethernetif.c`, `ethernetif.h`

---

### âš™ï¸ 2. Check Compiler and Linker Settings

#### â¤ Include Paths:
Go to **Project Properties** â†’ `XC32 Compiler â†’ Include directories`:
```
../lwip/include
../lwip/core
../lwip/netif
../lwip/apps/httpd
../lwip/port
```

#### â¤ Preprocessor Definitions:
Also define in compiler settings:
```c
LWIP_HTTPD=1
HTTPD_USE_CUSTOM_FSDATA=1
NO_SYS=1
```

If using static IP, no need for RTOS or `tcpip_thread`.

---

### ğŸ§  3. Static IP Configuration (main.c)

Inside your `main.c`:
```c
ip4_addr_t ipaddr, netmask, gw;

// Use an IP that matches your network
IP4_ADDR(&ipaddr, 192,168,1,123);
IP4_ADDR(&netmask, 255,255,255,0);
IP4_ADDR(&gw, 192,168,1,1);

netif_add(&netif, &ipaddr, &netmask, &gw, NULL, ethernetif_init, ethernet_input);
netif_set_default(&netif);
netif_set_up(&netif);

httpd_init();  // Start HTTP Server
```

---

### ğŸ”Œ 4. Hardware Setup

Make sure:

| Component | Status |
|----------|--------|
| Ethernet PHY | Connected via RMII (e.g., LAN8720 or ENC28J60) |
| RJ45 Jack | Plugged into your router |
| MCU Power | 3.3V stable |
| UART Debug | Optional (for IP printout) |

---

### ğŸ§ª 5. Build and Flash

In MPLAB:
- Click **Clean and Build Project**
- Click **Make and Program Device**
- Use your PICkit3/4 or ICD to flash the PIC32

---

### ğŸ“¡ 6. Connect to the Web Page

Once programmed:

1. Connect your PC to the **same network/router** as the PIC32
2. Open a browser and go to:
   ```
   http://192.168.1.123
   ```

You should see:

> **Hello from PIC32!**  
> (or whatever was in your `index.html`)

âœ… If you see the page â€” your lwIP HTTP server is running on your microcontroller!

---

### ğŸ” Optional Debug (UART)

If you want to print IP for confirmation:
```c
#include <stdio.h>
printf("IP Address: %s\n", ip4addr_ntoa(&ipaddr));
```

---
